import{a as k,A as l,b as w}from"./constants-BZTBaIRL.js";function u(){var n;const r=localStorage.getItem("user");let e=null;if(r)try{e=((n=JSON.parse(r).data)==null?void 0:n.accessToken)||null}catch(o){console.error("Failed to parse user data:",o)}const t=new Headers;return e?t.append("Authorization",`Bearer ${e}`):console.warn("No authorization token found."),t.append("X-Noroff-API-Key",k),t.append("Content-Type","application/json"),t}async function $(r=1,e=50){try{const t=await fetch(`${l}?_sort=createdAt&_order=desc&_page=${r}&_limit=${e}`);if(!t.ok)throw new Error("Failed to fetch listings");const n=await t.json(),o=Array.isArray(n.data)?n.data:[],a=parseInt(t.headers.get("X-Total-Count"),10)||0;return{items:o,totalCount:a}}catch(t){return console.error("Error during fetchAuctions:",t),{items:[],totalCount:0}}}async function B(r){const e=`${l}/${r}`;try{const t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch product details");return(await t.json()).data}catch(t){throw console.error("Error fetching product by ID:",t),t}}async function I(r){try{const e=`${l}/search?q=${encodeURIComponent(r)}`,t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch search results");return(await t.json()).data}catch(e){return console.error("Error during searchListings:",e),[]}}async function C(r,e){try{const t=u();if(!t.has("Authorization"))throw alert("You must be logged in to place a bid."),new Error("Authorization header missing.");const n=await fetch(`${l}/${r}/bids`,{method:"POST",headers:t,body:JSON.stringify({amount:e})});if(!n.ok){const o=await n.text();throw console.error("Response error:",o),new Error("Failed to add bid")}return await n.json()}catch(t){throw console.error("Error adding bid:",t),t}}async function q(r){try{const e=await fetch(`${w}/auction/profiles/${r}`,{headers:u()});if(!e.ok)throw new Error("Failed to fetch user profile");return await e.json()}catch(e){return console.error("Error fetching user profile:",e),null}}async function P(r){var n;const e=JSON.parse(localStorage.getItem("user"));if(!e||!((n=e.data)!=null&&n.name)){console.error("User not logged in or missing profile name");return}const t=[e.data.name];try{const o=await fetch(`${w}/auction/profiles/${t}`,{method:"PUT",headers:u(),body:JSON.stringify(r)});if(!o.ok)throw new Error("Failed to update user profile");return await o.json()}catch(o){throw console.error("Error updating user profile:",o),o}}async function O(r){try{const e=await fetch(l,{method:"POST",headers:u(),body:JSON.stringify(r)});if(!e.ok){const t=await e.text();throw new Error(t||"Failed to create listing")}return await e.json()}catch(e){throw console.error("Error creating listing:",e),e}}async function F(r){try{const e=await fetch(`${w}/auction/profiles/${r}/listings`,{headers:u()});if(!e.ok)throw new Error("Failed to fetch user listings");return(await e.json()).data||[]}catch(e){return console.error("Error fetching user listings:",e),[]}}async function _(r){try{const e=await fetch(`${l}/${r}`,{method:"DELETE",headers:u()});if(e.status!==204){const t=await e.text();throw new Error(t||"Failed to delete listing")}}catch(e){throw console.error("Error deleting listing:",e),e}}async function S(r=[],e=1,t=50){const n=document.getElementById("items-grid"),o=document.getElementById("pagination");if(!n||!o){console.error("Required containers not found.");return}const a=(e-1)*t,s=r.slice(a,a+t);if(!Array.isArray(s)||s.length===0){n.innerHTML='<p class="text-center">No items available to display.</p>';return}n.innerHTML="",s.forEach(i=>{var h,f,p,g,m,b,E;const d=document.createElement("div");d.className="col-md-4 mb-4",d.innerHTML=`
      <div class="card h-100">
        <div class="card-img-container">
        <img src="${((f=(h=i.media)==null?void 0:h[0])==null?void 0:f.url)||""}" class="card-img-top" alt="${((g=(p=i.media)==null?void 0:p[0])==null?void 0:g.alt)||"Image unavailable"}" style="display: ${(b=(m=i.media)==null?void 0:m[0])!=null&&b.url?"block":"none"};" />
        </div>
        <div class="card-body">
          <h5 class="card-title">${i.title}</h5>
          <p class="card-text">Starting bid: ${((E=i._count)==null?void 0:E.bids)||0} points</p>
          <a href="/src/pages/product.html?id=${i.id}" class="btn btn-dark">View Details</a>
        </div>
      </div>
    `,n.appendChild(d)}),x(o,Math.ceil(r.length/t),e,r)}function T(r){var n;const e=JSON.parse(localStorage.getItem("user")),t=((n=e==null?void 0:e.data)==null?void 0:n.name)||"Guest";r.innerHTML=`
    <div class="container-fluid welcome-section text-center text-white bg-dark-green py-5">
      <h1>Welcome to AuctionPlace, ${t}!</h1>
      <p>Start bidding on items or put up your own for auction.</p>
      <div class="search-bar d-flex justify-content-center mt-4">
        <input id="search-input" type="text" class="form-control w-50 me-2" placeholder="Search for items">
        <button id="search-button" class="btn btn-outline-dark">Search</button>
      </div>
      ${e?"":'<button class="btn btn-dark mt-4">Register now and get 1000 credits</button>'}
    </div>
  `}function A(){const r=document.querySelectorAll(".card");r.length&&r.forEach(e=>{e.addEventListener("click",t=>{if(t.target.tagName==="A")return;const n=e.getAttribute("data-id");if(!n){console.error("No product ID found on card.");return}window.location.href=`/src/pages/product.html?id=${n}`})})}function x(r,e,t,n){r.innerHTML="";for(let o=1;o<=e;o++){const a=document.createElement("button");a.className="btn btn-outline-dark mx-1",a.textContent=o,o===t&&a.classList.add("active"),a.addEventListener("click",()=>S(n,o)),r.appendChild(a)}}function M(){const r=document.getElementById("search-button"),e=document.getElementById("search-input"),t=document.getElementById("items-grid");if(!r||!e||!t){console.error("Search elements not found");return}r.addEventListener("click",async()=>{const n=e.value.trim();if(!n){alert("Please enter a search query");return}try{const o=await I(n);t.innerHTML="",o.length===0?t.innerHTML='<p class="text-center">No results found.</p>':o.forEach(a=>{var i,d,h,f,p,g,m;const s=document.createElement("div");s.className="col-md-4 mb-4",s.innerHTML=`
            <div class="card h-100">
              <div class="card-img-container">
              <img src="${((d=(i=a.media)==null?void 0:i[0])==null?void 0:d.url)||""}" class="card-img-top" alt="${((f=(h=a.media)==null?void 0:h[0])==null?void 0:f.alt)||"Image unavailable"}" style="display: ${(g=(p=a.media)==null?void 0:p[0])!=null&&g.url?"block":"none"};" />
              </div>
              <div class="card-body d-flex flex-column justify-content-between">
                <h5 class="card-title">${a.title}</h5>
                <p class="card-text">Starting bid: ${((m=a._count)==null?void 0:m.bids)||0} points</p>
                <a href="/src/pages/product.html?id=${a.id}" class="btn btn-dark">View Details</a>
              </div>
            </div>
          `,t.appendChild(s)})}catch(o){console.error("Error during search:",o),t.innerHTML='<p class="text-center">Error fetching search results.</p>'}})}const c=document.getElementById("app"),v={home:"/src/pages/home.html",login:"/src/pages/login.html",register:"/src/pages/registration.html",profile:"/src/pages/profile.html"};function N(){return!!localStorage.getItem("token")}function H(){const r=document.querySelector(".navbar-nav");r.innerHTML="",N()?r.innerHTML=`
      <li class="nav-item">
        <a class="nav-link" href="#" data-route="profile">Profile</a>
      </li>
      <li class="nav-item">
        <button class="btn btn-link nav-link" id="logoutBtn">Logout</button>
      </li>
    `:r.innerHTML=`
      <li class="nav-item">
        <a class="nav-link" href="#" data-route="login">Login</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" data-route="register">Register</a>
      </li>
    `;const e=document.getElementById("logoutBtn");e&&e.addEventListener("click",()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.history.pushState({page:"home"},"","/"),y("home")})}function L(r){const e=document.createElement("div");return e.classList.add("container"),r.appendChild(e),e}async function y(r){if(!c){console.warn("App container not found.");return}console.log("Loading page:",v[r]);try{const e=await fetch(v[r]);if(!e.ok){console.error("Error fetching page:",e.status,e.statusText),c.innerHTML="<p>Error loading page. Please try again later.</p>";return}const t=await e.text();if(c.innerHTML=t,r==="home"){let n=document.querySelector(".welcome-section");if(!n){console.warn("Welcome section not found in fetched content. Adding default structure...");const s=c.querySelector(".container")||L(c);s.insertAdjacentHTML("afterbegin",'<div class="welcome-section mb-4"></div>'),n=s.querySelector(".welcome-section")}T(n);let o=document.querySelector("#items-grid"),a=document.querySelector("#pagination");if(!o||!a){const s=c.querySelector(".container")||L(c);o||s.insertAdjacentHTML("beforeend",'<div id="items-grid" class="row"></div>'),a||s.insertAdjacentHTML("beforeend",'<div id="pagination" class="d-flex justify-content-center mt-4"></div>'),o=document.querySelector("#items-grid"),a=document.querySelector("#pagination")}try{const{items:s}=await $();await S(s),M(),A()}catch(s){console.error("Error loading home page:",s)}}}catch(e){console.error("Error loading page:",e),c.innerHTML="<p>Error loading content. Please try again later.</p>"}}document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",r=>{const e=r.target.closest("a[data-route]");if(e){r.preventDefault();const t=e.getAttribute("data-route");window.history.pushState({page:t},"",t==="home"?"/":`/${t}`),y(t)}}),y("home"),H(),window.addEventListener("popstate",r=>{var t;const e=((t=r.state)==null?void 0:t.page)||"home";y(e)})});export{P as a,F as b,O as c,_ as d,B as e,q as f,C as g,H as u};
