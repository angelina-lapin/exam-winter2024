import"./constants-CbZCZHJ1.js";import{u as m,f as p,a as g,c as f,b as y,d as E}from"./main-CKJOxmQk.js";async function l(){var u;const e=JSON.parse(localStorage.getItem("user"));if(!e||!((u=e.data)!=null&&u.name)){console.error("User not logged in or missing profile name");return}const t=await p(e.data.name);if(!t||!t.data){console.error("Failed to load profile data");return}const{name:a,email:o,avatar:n,banner:r,credits:s,bio:i,_count:c}=t.data;document.getElementById("profile-name").textContent=a,document.getElementById("profile-email").textContent=o,document.getElementById("profile-credit").textContent=s||0,document.getElementById("profile-avatar").src=(n==null?void 0:n.url)||"",document.getElementById("profile-banner-image").src=(r==null?void 0:r.url)||"",document.getElementById("profile-avatar").style.display=n!=null&&n.url?"block":"none",document.getElementById("profile-banner-image").style.display=r!=null&&r.url?"block":"none",i&&(document.getElementById("profile-bio").textContent=i),document.getElementById("listings-count").textContent=c.listings||0,document.getElementById("wins-count").textContent=c.wins||0}async function v(){document.getElementById("changeAvatarBtn").addEventListener("click",async()=>{const e=prompt("Enter the URL of your new avatar:");if(e)try{await g({avatar:{url:e,alt:"User avatar"}}),alert("Avatar updated successfully!"),await l()}catch(t){console.error("Error updating avatar:",t),alert("Failed to update avatar. Please try again.")}})}async function w(){document.getElementById("changeBannerBtn").addEventListener("click",async()=>{const e=prompt("Enter the URL of your new banner:");if(e)try{await g({banner:{url:e,alt:"User banner"}}),alert("Banner updated successfully!"),await l()}catch(t){console.error("Error updating banner:",t),alert("Failed to update banner. Please try again.")}})}async function B(){const e=document.getElementById("createListingForm");if(!e){console.error("Create Listing form not found");return}e.addEventListener("submit",async t=>{t.preventDefault();const a=document.getElementById("listingTitle").value.trim(),o=document.getElementById("listingDescription").value.trim(),n=document.getElementById("listingMedia").value.split(",").map(i=>({url:i.trim(),alt:"Media for listing"})).filter(i=>i.url),r=new Date(document.getElementById("listingDeadline").value).toISOString();if(!a||!r){alert("Title and deadline are required.");return}const s={title:a,description:o,media:n,endsAt:r};try{await f(s),alert("Listing created successfully!"),e.reset(),await d()}catch(i){console.error("Error creating listing:",i),alert("Failed to create listing. Please try again.")}})}async function d(){var a;const e=document.getElementById("userListings");if(!e){console.error("User listings container not found");return}const t=JSON.parse(localStorage.getItem("user"));if(!t||!((a=t.data)!=null&&a.name)){console.error("User not logged in or missing profile name");return}try{const o=await y(t.data.name);if(o.length===0){e.innerHTML='<p class="text-center">No listings available. Create your first listing!</p>';return}e.innerHTML=o.map(n=>{var r,s,i;return`
      <div class="col-md-4">
        <div class="card">
          <img src="${((r=media==null?void 0:media[0])==null?void 0:r.url)||""}" alt="${((s=media==null?void 0:media[0])==null?void 0:s.alt)||"No image available"}" class="img-fluid mx-auto d-block my-4" style="display: ${(i=media==null?void 0:media[0])!=null&&i.url?"block":"none"};" />

          <div class="card-body">
            <h5 class="card-title">${n.title}</h5>
            <p class="card-text">${n.description||"No description provided."}</p>
            <p><strong>Ends at:</strong> ${new Date(n.endsAt).toLocaleString()}</p>
            <button class="btn btn-danger btn-delete" data-id="${n.id}">Delete</button>
            <a href="/src/pages/product.html?id=${n.id}" class="btn btn-dark">View Details</a>
            
          </div>
        </div>
      </div>`}).join(""),L(),b()}catch(o){console.error("Error fetching user listings:",o),e.innerHTML='<p class="text-center">Error loading listings. Please try again later.</p>'}}function L(){document.querySelectorAll(".btn-delete").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const a=t.target.dataset.id;if(confirm("Are you sure you want to delete this listing?"))try{await E(a),alert("Listing deleted successfully!"),await d()}catch(o){console.error("Failed to delete listing:",o),alert("Failed to delete listing. Please try again.")}})})}function b(){document.querySelectorAll(".btn-view-details").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=t.target.dataset.id;a?window.location.href=`/product.html?id=${a}`:console.error("Listing ID not found.")})})}document.addEventListener("DOMContentLoaded",async()=>{m(),await l(),await v(),await w(),await B(),await d()});
